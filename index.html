<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Observatory at Liberty Hill Station</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --font-family-main: 'Poppins', sans-serif;
      --font-color: #000;
      --font-size: 17.866px;
      --letter-spacing: 0.35732px;
      --line-height: 32.1588px;
      --background-color: hsl(46.82, 100%, 50%);
      --card-background: #f8f8f8;
      --accent-green: #27AE60;
      --accent-blue: #3498DB;
      --accent-orange: #E67E22;
      --text-muted: #5D6D7E;
    }

    body {
      font-family: var(--font-family-main);
      font-size: var(--font-size);
      color: var(--font-color);
      background-color: var(--background-color);
      letter-spacing: var(--letter-spacing);
      line-height: var(--line-height);
      margin: 0;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18.66px 46.65px;
      background-color: var(--background-color);
      color: var(--font-color);
      box-sizing: border-box;
    }

    header img {
      max-height: 72px;
    }

    nav a {
      margin-left: 20px;
      text-decoration: none;
      color: var(--font-color);
      font-size: 1rem;
      transition: opacity 0.3s ease;
    }

    nav a:hover {
      opacity: 0.7;
    }

    nav a svg {
      vertical-align: middle;
      fill: #000;
      width: 18px;
      height: 18px;
    }

    main {
      padding: 40px 60px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Station Header */
    .station-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .live-status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #000;
      color: var(--background-color);
      padding: 12px 20px;
      border-radius: 25px;
      border: 4px solid transparent;
      outline: 2px solid #000;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .live-status:hover {
      outline: 4px solid #000;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      background: var(--accent-green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .live-text {
      font-weight: 500;
      color: var(--background-color);
    }

    .last-updated {
      color: var(--background-color);
      font-size: 0.9rem;
    }

    /* Current Conditions Grid */
    .conditions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin: 40px 0;
    }

    .condition-card {
      background: var(--card-background);
      padding: 25px;
      border-radius: 15px;
      border: 4px solid transparent;
      outline: 2px solid #000;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .condition-card:hover {
      outline: 4px solid #000;
      transform: translateY(-2px);
    }

    .condition-icon {
      width: 40px;
      height: 40px;
      margin-bottom: 15px;
      display: block;
    }

    .condition-value {
      font-size: 2.2rem;
      font-weight: 600;
      color: var(--font-color);
      margin-bottom: 8px;
    }

    .condition-label {
      font-size: 1rem;
      color: var(--font-color);
      margin-bottom: 5px;
    }

    .condition-detail {
      font-size: 0.85rem;
      color: var(--font-color);
    }

    /* Alert Banner */
    .alert-banner {
      background: #000;
      color: var(--background-color);
      padding: 20px 25px;
      border-radius: 12px;
      margin: 30px 0;
      border: 2px solid #000;
    }

    .alert-banner.warning {
      background: var(--accent-orange);
      color: #000;
      border: 2px solid #000;
    }

    .alert-banner.error {
      background: #E74C3C;
      color: #fff;
      border: 2px solid #000;
    }

    /* Data Sections */
    .data-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
      margin: 40px 0;
    }

    .data-section {
      background: var(--card-background);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid #000;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0 0 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-icon {
      width: 20px;
      height: 20px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .metric-row:last-child {
      border-bottom: none;
    }

    .metric-label {
      color: var(--font-color);
      font-weight: 500;
    }

    .metric-value {
      font-weight: 600;
      color: var(--font-color);
    }

    /* Chart Placeholder */
    .chart-placeholder {
      background: rgba(255, 255, 255, 0.5);
      border: 2px dashed var(--font-color);
      padding: 40px 20px;
      text-align: center;
      border-radius: 10px;
      margin-top: 20px;
      color: var(--font-color);
      font-style: italic;
    }

    /* CLI Report Section */
    .cli-report-section {
      margin: 40px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .cli-report {
      background: #ffffff;
      color: #000000;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      font-weight: bold;
      padding: 25px;
      border-radius: 10px;
      white-space: pre;
      overflow-x: auto;
      border: 2px solid #000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 680px;
      width: fit-content;
      tab-size: 8;
      -moz-tab-size: 8;
    }

    /* Footer Styles */
    footer {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--font-family-main);
      font-size: var(--font-size);
      padding: 15.55px 46.65px;
      background-color: var(--background-color);
      color: var(--font-color);
      box-sizing: border-box;
      margin-top: 60px;
    }

    .footer-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .footer-left a {
      color: var(--font-color);
      text-decoration: none;
      margin-bottom: 4px;
    }

    .footer-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    
    .footer-center img {
      height: 108px;
      width: 110px;
      object-fit: contain;
      object-position: center;
      display: block;
    }

    .footer-right a svg {
      height: 18px;
      width: 18px;
      fill: #000;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      main {
        padding: 20px 30px;
      }

      .conditions-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .data-sections {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      header {
        padding: 15px 30px;
      }

      footer {
        padding: 15px 30px;
        flex-direction: column;
        gap: 20px;
      }

      .footer-center {
        position: static;
        transform: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div style="display: flex; align-items: center;">
      <img src="FDZ-Logo-v13-WX.png" alt="The Observatory at Liberty Hill Station Logo" />
    </div>
    <nav>
      <a href="#live">Live Dashboard</a>
      <a href="#daily">Daily Reports</a>
      <a href="#historical">Historical Data</a>
      <a href="#station">Station Info</a>
      <a href="https://www.linkedin.com/in/seanlavigne" target="_blank" aria-label="LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M19 0h-14c-2.76 0-5 2.24-5 5v14c0 2.76 2.24 5 5 5h14c2.76 0 5-2.24 5-5v-14c0-2.76-2.24-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.27c-.97 0-1.75-.79-1.75-1.76 0-.97.79-1.75 1.75-1.75s1.75.78 1.75 1.75c0 .97-.78 1.76-1.75 1.76zm13.5 11.27h-3v-5.5c0-1.32-.03-3.01-1.84-3.01-1.84 0-2.12 1.43-2.12 2.91v5.6h-3v-10h2.88v1.36h.04c.4-.76 1.36-1.56 2.8-1.56 3 0 3.56 1.97 3.56 4.53v5.67z"/>
        </svg>
      </a>
    </nav>
  </header>

  <main>
    <div class="station-header">
      <div class="live-status">
        <div class="status-indicator"></div>
        <span class="live-text">Live Monitoring Active</span>
        <span class="last-updated" id="lastUpdated">‚Ä¢ Last updated: 2 minutes ago</span>
      </div>
    </div>

    <div class="conditions-grid">
      <div class="condition-card">
        <img src="icons/temperature.svg" alt="Temperature" class="condition-icon" />
        <div class="condition-value" id="temperature">87¬∞F</div>
        <div class="condition-label">Temperature</div>
        <div class="condition-detail" id="tempDetail">+5¬∞ above normal</div>
      </div>

      <div class="condition-card">
        <img src="icons/feels-like.svg" alt="Feels Like" class="condition-icon" />
        <div class="condition-value" id="feelsLike">92¬∞F</div>
        <div class="condition-label">Feels Like</div>
        <div class="condition-detail" id="feelsLikeDetail">Heat index 94¬∞F</div>
      </div>

      <div class="condition-card">
        <img src="icons/wind.svg" alt="Wind" class="condition-icon" />
        <div class="condition-value" id="windSpeed">12 mph</div>
        <div class="condition-label">Wind Speed</div>
        <div class="condition-detail" id="windDetail">SSW gusts to 18 mph</div>
      </div>

      <div class="condition-card">
        <img src="icons/humidity.svg" alt="Humidity" class="condition-icon" />
        <div class="condition-value" id="humidity">67%</div>
        <div class="condition-label">Humidity</div>
        <div class="condition-detail" id="humidityDetail">Dew point 72¬∞F</div>
      </div>

      <div class="condition-card">
        <img src="icons/pressure.svg" alt="Pressure" class="condition-icon" />
        <div class="condition-value" id="pressure">29.85</div>
        <div class="condition-label">Pressure</div>
        <div class="condition-detail" id="pressureDetail">Rising ‚Üó</div>
      </div>

      <div class="condition-card">
        <img src="icons/rain.svg" alt="Rain" class="condition-icon" />
        <div class="condition-value" id="rainfall">0.00"</div>
        <div class="condition-label">Today's Rain</div>
        <div class="condition-detail" id="rainDetail">0.12" last hour</div>
      </div>

      <div class="condition-card">
        <img src="icons/solar.svg" alt="Solar" class="condition-icon" />
        <div class="condition-value" id="solarRadiation">850</div>
        <div class="condition-label">Solar Radiation</div>
        <div class="condition-detail" id="solarDetail">W/m¬≤ ‚Ä¢ UV: 8</div>
      </div>

      <div class="condition-card">
        <img src="icons/lightning.svg" alt="Lightning" class="condition-icon" />
        <div class="condition-value" id="lightningStrikes">18</div>
        <div class="condition-label">Lightning Strikes</div>
        <div class="condition-detail" id="lightningDetail">Last: 5.2mi away</div>
      </div>

      <div class="condition-card">
        <img src="icons/aircraft.svg" alt="Aircraft" class="condition-icon" />
        <div class="condition-value" id="aircraftCount">142</div>
        <div class="condition-label">Aircraft Tracked</div>
        <div class="condition-detail" id="aircraftDetail">Collected in last 30 min</div>
      </div>

      <div class="condition-card">
        <img src="icons/seismic.svg" alt="Seismic" class="condition-icon" />
        <div class="condition-value" id="seismicMeasurements">8,420</div>
        <div class="condition-label">Seismic Samples</div>
        <div class="condition-detail" id="seismicDetail">Collected in last 30 min</div>
      </div>
    </div>

    <div class="alert-banner" id="statusAlert">
      <div style="display: inline-flex; align-items: center; gap: 8px;">
        <div style="width: 12px; height: 12px; background: #27AE60; border-radius: 50%; animation: pulse 2s infinite;"></div>
        <strong>All Systems Operational:</strong>
      </div>
      Weather station online ‚Ä¢ Aircraft tracking active ‚Ä¢ Seismic monitoring normal ‚Ä¢ No severe weather alerts
    </div>

    <div class="data-sections">
      <div class="data-section">
        <h2 class="section-title">
          <img src="icons/weather.svg" alt="Weather" class="section-icon" />
          Weather Conditions
        </h2>
        <div class="metric-row">
          <span class="metric-label">High Temperature</span>
          <span class="metric-value" id="highTemp">87¬∞F (Normal: 82¬∞F)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Low Temperature</span>
          <span class="metric-value" id="lowTemp">68¬∞F (Normal: 65¬∞F)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Heat Index</span>
          <span class="metric-value" id="heatIndex">94¬∞F (Caution level)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Wind Chill</span>
          <span class="metric-value" id="windChill">N/A (Above 50¬∞F)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Wet Bulb Globe Temp</span>
          <span class="metric-value" id="wetBulbGlobe">82¬∞F (Moderate stress)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Barometric Pressure</span>
          <span class="metric-value" id="pressureBarometric">29.85 inHg (Rising ‚Üó)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Station Pressure</span>
          <span class="metric-value" id="pressureStation">29.82 inHg</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Sea Level Pressure</span>
          <span class="metric-value" id="pressureSeaLevel">29.87 inHg</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Wind Lull</span>
          <span class="metric-value" id="windLull">8 mph (variable winds)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Brightness</span>
          <span class="metric-value" id="brightness">85,000 lux</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Air Density</span>
          <span class="metric-value" id="airDensity">1.185 kg/m¬≥</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">UV Index</span>
          <span class="metric-value" id="uvIndex">8 (Very High)</span>
        </div>
        <div class="chart-placeholder">
          üìà Temperature & Pressure Trends
          <br>Chart generated by n8n automation
        </div>
      </div>

      <div class="data-section">
        <h2 class="section-title">
          <img src="icons/lightning.svg" alt="Lightning" class="section-icon" />
          Lightning & Precipitation
        </h2>
        <div class="metric-row">
          <span class="metric-label">Lightning Strikes (Total)</span>
          <span class="metric-value" id="lightningTotal">18 detected</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Strikes (Last Hour)</span>
          <span class="metric-value" id="lightningLastHour">12 strikes</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Strikes (Last 3 Hours)</span>
          <span class="metric-value" id="lightningLast3Hours">23 strikes</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Last Strike Distance</span>
          <span class="metric-value" id="lightningDistance">5.2 miles away</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Current Precipitation</span>
          <span class="metric-value" id="precipCurrent">0.00 in/hr</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Last Hour Accumulation</span>
          <span class="metric-value" id="precipLastHour">0.12 inches</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Today's Total</span>
          <span class="metric-value" id="precipToday">0.24 inches</span>
        </div>
        <div class="chart-placeholder">
          ‚ö° Lightning Activity Map
          <br>Strike locations and precipitation radar
        </div>
      </div>

      <div class="data-section">
        <h2 class="section-title">
          <img src="icons/aircraft.svg" alt="Aircraft" class="section-icon" />
          Aviation Activity
        </h2>
        <div class="metric-row">
          <span class="metric-label">Total Aircraft</span>
          <span class="metric-value" id="totalAircraft">142 tracked (last 30 min)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Commercial Flights</span>
          <span class="metric-value" id="commercialFlights">89 aircraft</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">General Aviation</span>
          <span class="metric-value" id="generalAviation">53 aircraft</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Life Flight / EMS</span>
          <span class="metric-value" id="lifeFlights">2 aircraft</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Military Aircraft</span>
          <span class="metric-value" id="militaryAircraft">10 aircraft</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Highest Altitude</span>
          <span class="metric-value" id="highestAltitude">41,000 ft</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Aircraft Within 10mi</span>
          <span class="metric-value" id="aircraftNearby">23 aircraft</span>
        </div>
        <div class="chart-placeholder">
          üó∫Ô∏è Aircraft Activity Map
          <br>Real-time ADS-B tracking visualization
        </div>
      </div>

      <div class="data-section">
        <h2 class="section-title">
          <img src="icons/seismic.svg" alt="Seismic" class="section-icon" />
          Seismic Monitoring
        </h2>
        <div class="metric-row">
          <span class="metric-label">Data Samples</span>
          <span class="metric-value" id="seismicSamples">8,420 samples (last 30 min)</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Channels Active</span>
          <span class="metric-value" id="seismicChannels">4 channels</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Sample Rate</span>
          <span class="metric-value" id="sampleRate">100 Hz</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Recent Events</span>
          <span class="metric-value" id="recentEvents">2 detected</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Station Health</span>
          <span class="metric-value" id="stationHealth">Excellent</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Total Observations</span>
          <span class="metric-value" id="totalObservations">1,847,293 recorded</span>
        </div>
        <div class="chart-placeholder">
          üìà Seismogram Display
          <br>Live waveform data from RaspberryShake
        </div>
      </div>

      <div class="data-section">
        <h2 class="section-title">
          <img src="icons/system.svg" alt="System" class="section-icon" />
          System Status
        </h2>
        <div class="metric-row">
          <span class="metric-label">Data Uptime</span>
          <span class="metric-value" id="dataUptime">99.8%</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Database Records</span>
          <span class="metric-value" id="databaseRecords">1,847,293 observations</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Last Maintenance</span>
          <span class="metric-value" id="lastMaintenance">5 days ago</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Sensor Health</span>
          <span class="metric-value" id="sensorHealth">All Good</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Next Calibration</span>
          <span class="metric-value" id="nextCalibration">14 days</span>
        </div>
        <div class="metric-row">
          <span class="metric-label">Storage Used</span>
          <span class="metric-value" id="storageUsed">47.3 GB (23%)</span>
        </div>
        <div class="chart-placeholder">
          üíæ System Performance
          <br>Storage, CPU, and network metrics
        </div>
      </div>
    </div>

<div class="cli-report-section">
  <h2>Latest Station Report</h2>
  <div class="cli-report" id="latest-report">
    Loading latest station report...
  </div>
  <div style="margin-top: 15px;">
    <a href="reports.html" style="color: #000; text-decoration: none; font-weight: bold; border: 2px solid #000; padding: 8px 16px; border-radius: 5px; background: hsl(46.82, 100%, 50%);">
      View All Reports Archive ‚Üí
    </a>
  </div>
</div>

<script>
async function loadLatestReport() {
  const today = new Date();
  const currentYear = today.getFullYear();
  
  // Try dates in order: today, yesterday, 2 days ago
  // This accounts for reports being generated the following morning
  const datesToTry = [
    new Date(today),                    // Today's report (if available)
    new Date(today.getTime() - 86400000),   // Yesterday  
    new Date(today.getTime() - 172800000)   // 2 days ago
  ];
  
  console.log('Searching for latest daily report...');
  
  for (const date of datesToTry) {
    const year = date.getFullYear();
    const dateString = date.toISOString().split('T')[0]; // YYYY-MM-DD format
    const reportPath = `data/daily/${year}/LHS-Daily-${dateString}.txt`;
    const reportUrl = `https://raw.githubusercontent.com/SeanFDZ/environmental-station/main/${reportPath}`;
    
    try {
      console.log(`Checking for report: ${reportPath}`);
      const response = await fetch(reportUrl);
      
      if (response.ok) {
        const reportContent = await response.text();
        console.log(`‚úÖ Found latest report: ${dateString}`);
        
        document.getElementById('latest-report').textContent = reportContent;
        
        // Update the section title with the date
        const reportSection = document.querySelector('.cli-report-section h2');
        if (reportSection) {
          const reportDate = new Date(date);
          const formattedDate = reportDate.toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric', 
            month: 'long',
            day: 'numeric'
          });
          reportSection.textContent = `Latest Station Report - ${formattedDate}`;
        }
        
        return;
      }
    } catch (error) {
      console.log(`‚ùå Report not found: ${dateString}`);
    }
  }
  
  // If no recent reports found, show fallback message
  console.log('‚ö†Ô∏è No recent daily reports found');
  document.getElementById('latest-report').textContent = '‚è≥ Latest daily report is being generated...\n\nReports are typically available by 7:00 AM Central Time the following day.';
}

// Load the latest report when page loads
document.addEventListener('DOMContentLoaded', loadLatestReport);
</script>
  </main>

  <footer>
    <div class="footer-left">
      <a href="mailto:Observatory@FallingData.Zone">Observatory@FallingData.Zone</a>
      <span>Powered by Data & Strategy</span>
    </div>
    <div class="footer-center">
      <img src="FDZ-Logo-Only.png" alt="Falling Data Logo" />
    </div>
    <div class="footer-right">
      <a href="https://www.linkedin.com/in/seanlavigne" target="_blank" aria-label="LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M19 0h-14c-2.76 0-5 2.24-5 5v14c0 2.76 2.24 5 5 5h14c2.76 0 5-2.24 5-5v-14c0-2.76-2.24-5-5-5zm-11 19h-3v-10h3v10zm-1.5-11.27c-.97 0-1.75-.79-1.75-1.76 0-.97.79-1.75 1.75-1.75s1.75.78 1.75 1.75c0 .97-.78 1.76-1.75 1.76zm13.5 11.27h-3v-5.5c0-1.32-.03-3.01-1.84-3.01-1.84 0-2.12 1.43-2.12 2.91v5.6h-3v-10h2.88v1.36h.04c.4-.76 1.36-1.56 2.8-1.56 3 0 3.56 1.97 3.56 4.53v5.67z"/>
        </svg>
      </a>
    </div>
  </footer>

  <script>
    // Live Data Management
    class ObservatoryDashboard {
      constructor() {
        this.lastUpdateTime = new Date();
        this.refreshInterval = 60000; // 60 seconds
        this.init();
      }

      async init() {
        await this.loadLiveData();
        this.startAutoRefresh();
      }

      async loadLiveData() {
        try {
          const response = await fetch('/data/current.json');
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          console.log('Live data loaded:', data);
          
          this.updateDashboard(data);
          this.lastUpdateTime = new Date(data.timestamp);
          this.updateLastUpdatedTime();
          
        } catch (error) {
          console.error('Error loading live data:', error);
          this.showError('Unable to load live data');
        }
      }

      updateDashboard(data) {
        // Update main condition cards
        if (data.weather) {
          this.updateElement('temperature', `${data.weather.temperature}¬∞F`);
          this.updateElement('feelsLike', `${data.weather.feelsLike}¬∞F`);
          this.updateElement('feelsLikeDetail', `Heat index ${data.weather.heatIndex}¬∞F`);
          this.updateElement('rainDetail', `${data.weather.precipitationLastHour}" last hour`);
          this.updateElement('humidity', `${data.weather.humidity}%`);
          this.updateElement('pressure', data.weather.pressure);
          this.updateElement('windSpeed', `${data.weather.windSpeed} mph`);
          this.updateElement('rainfall', `${data.weather.precipitation}"`);
          this.updateElement('solarRadiation', data.weather.solarRadiation);
          this.updateElement('lightningStrikes', data.weather.lightningStrikes);
          
          // Update detailed weather section
          this.updateElement('highTemp', `${data.weather.temperature}¬∞F (Normal: ${data.weather.normalHigh}¬∞F)`);
          this.updateElement('lowTemp', `${data.weather.normalLow}¬∞F (Normal: ${data.weather.normalLow}¬∞F)`);
          this.updateElement('heatIndex', `${data.weather.heatIndex}¬∞F (${this.getHeatIndexLevel(data.weather.heatIndex)})`);
          this.updateElement('windChill', data.weather.temperature > 50 ? 'N/A (Above 50¬∞F)' : `${data.weather.windChill}¬∞F`);
          this.updateElement('wetBulbGlobe', `${data.weather.wetBulbGlobeTemperature}¬∞F (${this.getWBGTLevel(data.weather.wetBulbGlobeTemperature)})`);
          this.updateElement('pressureBarometric', `${data.weather.pressure} inHg (${data.weather.pressureTrend} ${this.getPressureTrendArrow(data.weather.pressureTrend)})`);
          this.updateElement('pressureStation', `${data.weather.stationPressure} inHg`);
          this.updateElement('pressureSeaLevel', `${(parseFloat(data.weather.pressure) + 0.02).toFixed(2)} inHg`); // Estimated
          this.updateElement('windLull', `${data.weather.windLull} mph (variable winds)`);
          this.updateElement('brightness', `${data.weather.brightness.toLocaleString()} lux`);
          this.updateElement('airDensity', `${data.weather.airDensity} kg/m¬≥`);
          this.updateElement('uvIndex', `${data.weather.uvIndex} (${this.getUVDescription(data.weather.uvIndex)})`);
          
          // Update lightning & precipitation section
          this.updateElement('lightningTotal', `${data.weather.lightningStrikes} detected`);
          this.updateElement('lightningLastHour', `${data.weather.lightningStrikesLastHour} strikes`);
          this.updateElement('lightningLast3Hours', `${data.weather.lightningStrikesLast3Hours} strikes`);
          this.updateElement('lightningDistance', data.weather.lightningLastDistance > 0 ? `${data.weather.lightningLastDistance} miles away` : 'No recent strikes');
          this.updateElement('precipCurrent', `${data.weather.precipitationRate} in/hr`);
          this.updateElement('precipLastHour', `${data.weather.precipitationLastHour} inches`);
          this.updateElement('precipToday', `${data.weather.precipitation} inches`);
          
          // Update card details
          this.updateElement('tempDetail', `${data.weather.temperature > data.weather.normalHigh ? '+' : ''}${data.weather.temperature - data.weather.normalHigh}¬∞ vs normal`);
          this.updateElement('windDetail', `${this.getWindDirection(data.weather.windDirection)} gusts to ${data.weather.windGust} mph`);
          this.updateElement('humidityDetail', `Dew point ${data.weather.dewPoint}¬∞F`);
          this.updateElement('solarDetail', `W/m¬≤ ‚Ä¢ UV: ${data.weather.uvIndex}`);
          this.updateElement('lightningDetail', data.weather.lightningStrikes > 0 ? 'Active nearby' : 'No activity');
        }
      
        // Update aircraft data
        if (data.aircraft) {
          this.updateElement('aircraftCount', data.aircraft.total);
          this.updateElement('totalAircraft', `${data.aircraft.total} tracked (last 30 min)`);
          this.updateElement('commercialFlights', `${data.aircraft.commercial} aircraft`);
          this.updateElement('generalAviation', `${data.aircraft.generalAviation} aircraft`);
          this.updateElement('lifeFlights', `${data.aircraft.lifeFlights} aircraft`);
          this.updateElement('militaryAircraft', `${data.aircraft.military} aircraft`);
          this.updateElement('highestAltitude', `${data.aircraft.highestAltitude.toLocaleString()} ft`);
          this.updateElement('aircraftNearby', `${data.aircraft.aircraftNearby} aircraft`);
        }
      
        // Update seismic data
        if (data.seismic) {
          this.updateElement('seismicMeasurements', data.seismic.totalObservations.toLocaleString());
          this.updateElement('seismicSamples', `${data.seismic.totalObservations.toLocaleString()} samples (last 30 min)`);
          this.updateElement('seismicChannels', `${data.seismic.activeChannels} channels`);
          this.updateElement('sampleRate', `${data.seismic.sampleRate} Hz`);
          this.updateElement('recentEvents', `${data.seismic.recentEvents} detected`);
          this.updateElement('stationHealth', data.seismic.stationHealth);
          this.updateElement('totalObservations', `${data.seismic.totalHistoricalObservations.toLocaleString()} recorded`);
        }
      
        // Update system status
        if (data.system) {
          this.updateElement('dataUptime', `${data.system.dataUptime}%`);
          this.updateElement('databaseRecords', `${data.system.databaseRecords.toLocaleString()} observations`);
          this.updateElement('lastMaintenance', data.system.lastMaintenance);
          this.updateElement('sensorHealth', data.system.sensorHealth);
          this.updateElement('nextCalibration', data.system.nextCalibration);
          this.updateElement('storageUsed', `${data.system.storageUsedGB} GB (${data.system.storageUsedPercent}%)`);
        }
      
        // Update alerts
        if (data.alerts) {
          const alertBanner = document.getElementById('statusAlert');
          if (alertBanner) {
            alertBanner.innerHTML = `
              <div style="display: inline-flex; align-items: center; gap: 8px;">
                <div style="width: 12px; height: 12px; background: #27AE60; border-radius: 50%; animation: pulse 2s infinite;"></div>
                <strong>All Systems Operational:</strong>
              </div>
              ${data.alerts.statusMessage}
            `;
            alertBanner.className = data.alerts.hasAlerts ? 'alert-banner warning' : 'alert-banner';
          }
        }
      }
      
      // Add these helper functions
      getHeatIndexLevel(heatIndex) {
        if (heatIndex < 80) return 'Normal';
        if (heatIndex < 90) return 'Caution level';
        if (heatIndex < 105) return 'Extreme caution';
        return 'Danger level';
      }
      
      getWBGTLevel(wbgt) {
        if (wbgt < 78) return 'Low stress';
        if (wbgt < 82) return 'Moderate stress';
        if (wbgt < 86) return 'High stress';
        return 'Extreme stress';
      }
      
      getPressureTrendArrow(trend) {
        if (trend === 'rising') return '‚Üó';
        if (trend === 'falling') return '‚Üò';
        return '‚Üí';
      }

      updateElement(id, value) {
        const element = document.getElementById(id);
        if (element) {
          element.textContent = value;
        }
      }

      getWindDirection(degrees) {
        const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
        const index = Math.round(degrees / 22.5) % 16;
        return directions[index];
      }

      getUVDescription(uv) {
        if (uv <= 2) return 'Low';
        if (uv <= 5) return 'Moderate';
        if (uv <= 7) return 'High';
        if (uv <= 10) return 'Very High';
        return 'Extreme';
      }

      updateLastUpdatedTime() {
        const element = document.getElementById('lastUpdated');
        if (element) {
          const now = new Date();
          const diffMinutes = Math.floor((now - this.lastUpdateTime) / 60000);
          element.textContent = `‚Ä¢ Last updated: ${diffMinutes === 0 ? 'Just now' : diffMinutes + ' minutes ago'}`;
        }
      }

      showError(message) {
        const alertBanner = document.getElementById('statusAlert');
        if (alertBanner) {
          alertBanner.textContent = message;
          alertBanner.className = 'alert-banner error';
        }
      }

      startAutoRefresh() {
        setInterval(() => {
          this.loadLiveData();
        }, this.refreshInterval);

        // Update the "last updated" time every minute
        setInterval(() => {
          this.updateLastUpdatedTime();
        }, 60000);
      }
    }

    // Initialize the dashboard when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      new ObservatoryDashboard();
    });
  </script>
